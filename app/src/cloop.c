#include "cloop.h"
#include "includes.h"
#include "pwm.h"
#include "encoder.h"
#include "cli.h"
#include "as5047d.h"

cLoopObj Current;

SVPWMObj SVPWM;

//int Cd[1000];
int Cq[1000];
int Cn=0;
int tuningStartFlag=0;
int Cti=100;//Tuning target Current value

/**
  * @brief  Lookup table for Sin
  * @param  None
  * @retval None
  */
const float SinBox[3600]= 
{
	0,0.00174533,0.00349065,0.00523596,0.00698126,0.00872654,0.0104718,0.012217,0.0139622,0.0157073,0.0174524,0.0191974,0.0209424,0.0226873,0.0244322,0.0261769,0.0279216,0.0296662,0.0314108,0.0331552,0.0348995,0.0366437,0.0383878,0.0401318,0.0418757,0.0436194,0.045363,0.0471065,0.0488498,0.0505929,0.052336,0.0540788,0.0558215,0.057564,0.0593064,0.0610485,0.0627905,0.0645323,0.0662739,0.0680153,0.0697565,0.0714974,0.0732382,0.0749787,0.076719,0.0784591,0.0801989,0.0819385,0.0836778,0.0854169,0.0871557,0.0888943,0.0906326,0.0923706,0.0941083,0.0958458,0.0975829,0.0993197,0.101056,0.102793,0.104528,0.106264,0.107999,0.109734,0.111469,0.113203,0.114937,0.116671,0.118404,0.120137,0.121869,0.123601,0.125333,0.127065,0.128796,0.130526,0.132256,0.133986,0.135716,0.137445,0.139173,0.140901,0.142629,0.144356,0.146083,0.147809,0.149535,0.151261,0.152986,0.15471,0.156434,0.158158,0.159881,0.161604,0.163326,0.165048,0.166769,0.168489,0.170209,0.171929,0.173648,0.175367,0.177085,0.178802,0.180519,0.182236,0.183951,0.185667,0.187381,0.189095,0.190809,0.192522,0.194234,0.195946,0.197657,0.199368,0.201078,0.202787,0.204496,0.206204,0.207912,0.209619,0.211325,0.21303,0.214735,0.21644,0.218143,0.219846,0.221548,0.22325,0.224951,0.226651,0.228351,0.23005,0.231748,0.233445,0.235142,0.236838,0.238533,0.240228,0.241922,0.243615,0.245307,0.246999,0.24869,0.25038,0.252069,0.253758,0.255446,0.257133,0.258819,0.260505,0.262189,0.263873,0.265556,0.267238,0.26892,0.2706,0.27228,0.273959,0.275637,0.277315,0.278991,0.280667,0.282341,0.284015,0.285688,0.287361,0.289032,0.290702,0.292372,0.29404,0.295708,0.297375,0.299041,0.300706,0.30237,0.304033,0.305695,0.307357,0.309017,0.310676,0.312335,0.313992,0.315649,0.317305,0.318959,0.320613,0.322266,0.323917,0.325568,0.327218,0.328867,0.330514,0.332161,0.333807,0.335452,0.337095,0.338738,0.34038,0.34202,0.34366,0.345298,0.346936,0.348572,0.350207,0.351842,0.353475,0.355107,0.356738,0.358368,0.359997,0.361625,0.363251,0.364877,0.366501,0.368125,0.369747,0.371368,0.372988,0.374607,0.376224,0.377841,0.379456,0.38107,0.382683,0.384295,0.385906,0.387516,0.389124,0.390731,0.392337,0.393942,0.395546,0.397148,0.398749,0.400349,0.401948,0.403545,0.405142,0.406737,0.40833,0.409923,0.411514,0.413104,0.414693,0.416281,0.417867,0.419452,0.421036,0.422618,0.424199,0.425779,0.427358,0.428935,0.430511,0.432086,0.433659,0.435231,0.436802,0.438371,0.439939,0.441506,0.443071,0.444635,0.446198,0.447759,0.449319,0.450878,0.452435,0.45399,0.455545,0.457098,0.45865,0.4602,0.461749,0.463296,0.464842,0.466387,0.46793,0.469472,0.471012,0.472551,0.474088,0.475624,0.477159,0.478692,0.480223,0.481754,0.483282,0.48481,0.486335,0.48786,0.489382,0.490904,0.492424,0.493942,0.495459,0.496974,0.498488,0.5,0.501511,0.50302,0.504528,0.506034,0.507538,0.509041,0.510543,0.512043,0.513541,0.515038,0.516533,0.518027,0.519519,0.52101,0.522499,0.523986,0.525472,0.526956,0.528438,0.529919,0.531399,0.532876,0.534352,0.535827,0.5373,0.538771,0.54024,0.541708,0.543174,0.544639,0.546102,0.547563,0.549023,0.550481,0.551937,0.553392,0.554844,0.556296,0.557745,0.559193,0.560639,0.562083,0.563526,0.564967,0.566406,0.567844,0.56928,0.570714,0.572146,0.573576,0.575005,0.576432,0.577858,0.579281,0.580703,0.582123,0.583541,0.584958,0.586372,0.587785,0.589196,0.590606,0.592013,0.593419,0.594823,0.596225,0.597625,0.599024,0.60042,0.601815,0.603208,0.604599,0.605988,0.607376,0.608761,0.610145,0.611527,0.612907,0.614285,0.615661,0.617036,0.618408,0.619779,0.621148,0.622515,0.62388,0.625243,0.626604,0.627963,0.62932,0.630676,0.632029,0.633381,0.634731,0.636078,0.637424,0.638768,0.64011,0.64145,0.642788,0.644124,0.645458,0.64679,0.64812,0.649448,0.650774,0.652098,0.653421,0.654741,0.656059,0.657375,0.658689,0.660002,0.661312,0.66262,0.663926,0.66523,0.666532,0.667833,0.669131,0.670427,0.671721,0.673013,0.674302,0.67559,0.676876,0.67816,0.679441,0.680721,0.681998,0.683274,0.684547,0.685818,0.687088,0.688355,0.68962,0.690882,0.692143,0.693402,0.694658,0.695913,0.697165,0.698415,0.699663,0.700909,0.702153,0.703395,0.704634,0.705872,0.707107,0.70834,0.709571,0.710799,0.712026,0.71325,0.714473,0.715693,0.716911,0.718126,0.71934,0.720551,0.72176,0.722967,0.724172,0.725374,0.726575,0.727773,0.728969,0.730162,0.731354,0.732543,0.73373,0.734915,0.736097,0.737277,0.738455,0.739631,0.740805,0.741976,0.743145,0.744312,0.745476,0.746638,0.747798,0.748956,0.750111,0.751264,0.752415,0.753563,0.75471,0.755853,0.756995,0.758134,0.759271,0.760406,0.761538,0.762668,0.763796,0.764921,0.766044,0.767165,0.768284,0.7694,0.770513,0.771625,0.772734,0.77384,0.774944,0.776046,0.777146,0.778243,0.779338,0.78043,0.78152,0.782608,0.783693,0.784776,0.785857,0.786935,0.788011,0.789084,0.790155,0.791224,0.79229,0.793353,0.794415,0.795473,0.79653,0.797584,0.798636,0.799685,0.800731,0.801776,0.802817,0.803857,0.804894,0.805928,0.80696,0.80799,0.809017,0.810042,0.811064,0.812084,0.813101,0.814116,0.815128,0.816138,0.817145,0.81815,0.819152,0.820152,0.821149,0.822144,0.823136,0.824126,0.825113,0.826098,0.827081,0.82806,0.829038,0.830012,0.830984,0.831954,0.832921,0.833886,0.834848,0.835807,0.836764,0.837719,0.838671,0.83962,0.840567,0.841511,0.842452,0.843391,0.844328,0.845262,0.846193,0.847122,0.848048,0.848972,0.849893,0.850811,0.851727,0.85264,0.853551,0.854459,0.855364,0.856267,0.857167,0.858065,0.85896,0.859852,0.860742,0.861629,0.862514,0.863396,0.864275,0.865151,0.866025,0.866897,0.867765,0.868632,0.869495,0.870356,0.871214,0.872069,0.872922,0.873772,0.87462,0.875465,0.876307,0.877146,0.877983,0.878817,0.879649,0.880477,0.881303,0.882127,0.882948,0.883766,0.884581,0.885394,0.886204,0.887011,0.887815,0.888617,0.889416,0.890213,0.891007,0.891798,0.892586,0.893371,0.894154,0.894934,0.895712,0.896486,0.897258,0.898028,0.898794,0.899558,0.900319,0.901077,0.901833,0.902585,0.903335,0.904083,0.904827,0.905569,0.906308,0.907044,0.907777,0.908508,0.909236,0.909961,0.910684,0.911403,0.91212,0.912834,0.913545,0.914254,0.91496,0.915663,0.916363,0.91706,0.917755,0.918446,0.919135,0.919821,0.920505,0.921185,0.921863,0.922538,0.92321,0.92388,0.924546,0.92521,0.925871,0.926529,0.927184,0.927836,0.928486,0.929133,0.929776,0.930418,0.931056,0.931691,0.932324,0.932954,0.93358,0.934204,0.934826,0.935444,0.93606,0.936672,0.937282,0.937889,0.938493,0.939094,0.939693,0.940288,0.940881,0.941471,0.942057,0.942641,0.943223,0.943801,0.944376,0.944949,0.945519,0.946085,0.946649,0.94721,0.947768,0.948324,0.948876,0.949425,0.949972,0.950516,0.951057,0.951594,0.952129,0.952661,0.953191,0.953717,0.95424,0.954761,0.955278,0.955793,0.956305,0.956814,0.957319,0.957822,0.958323,0.95882,0.959314,0.959805,0.960294,0.960779,0.961262,0.961741,0.962218,0.962692,0.963163,0.96363,0.964095,0.964557,0.965016,0.965473,0.965926,0.966376,0.966823,0.967268,0.967709,0.968148,0.968583,0.969016,0.969445,0.969872,0.970296,0.970716,0.971134,0.971549,0.971961,0.97237,0.972776,0.973179,0.973579,0.973976,0.97437,0.974761,0.975149,0.975535,0.975917,0.976296,0.976672,0.977046,0.977416,0.977783,0.978148,0.978509,0.978867,0.979223,0.979575,0.979925,0.980271,0.980615,0.980955,0.981293,0.981627,0.981959,0.982287,0.982613,0.982935,0.983255,0.983571,0.983885,0.984196,0.984503,0.984808,0.985109,0.985408,0.985703,0.985996,0.986286,0.986572,0.986856,0.987136,0.987414,0.987688,0.98796,0.988228,0.988494,0.988756,0.989016,0.989272,0.989526,0.989776,0.990024,0.990268,0.990509,0.990748,0.990983,0.991216,0.991445,0.991671,0.991894,0.992115,0.992332,0.992546,0.992757,0.992966,0.993171,0.993373,0.993572,0.993768,0.993961,0.994151,0.994338,0.994522,0.994703,0.994881,0.995056,0.995227,0.995396,0.995562,0.995725,0.995884,0.996041,0.996195,0.996345,0.996493,0.996637,0.996779,0.996917,0.997053,0.997185,0.997314,0.997441,0.997564,0.997684,0.997801,0.997916,0.998027,0.998135,0.99824,0.998342,0.998441,0.998537,0.99863,0.998719,0.998806,0.99889,0.998971,0.999048,0.999123,0.999194,0.999263,0.999328,0.999391,0.99945,0.999507,0.99956,0.99961,0.999657,0.999701,0.999743,0.999781,0.999816,0.999848,0.999877,0.999903,0.999925,0.999945,0.999962,0.999976,0.999986,0.999994,0.999998,1,0.999998,0.999994,0.999986,0.999976,0.999962,0.999945,0.999925,0.999903,0.999877,0.999848,0.999816,0.999781,0.999743,0.999701,0.999657,0.99961,0.99956,0.999507,0.99945,0.999391,0.999328,0.999263,0.999194,0.999123,0.999048,0.998971,0.99889,0.998806,0.998719,0.99863,0.998537,0.998441,0.998342,0.99824,0.998135,0.998027,0.997916,0.997801,0.997684,0.997564,0.997441,0.997314,0.997185,0.997053,0.996917,0.996779,0.996637,0.996493,0.996345,0.996195,0.996041,0.995884,0.995725,0.995562,0.995396,0.995227,0.995056,0.994881,0.994703,0.994522,0.994338,0.994151,0.993961,0.993768,0.993572,0.993373,0.993171,0.992966,0.992757,0.992546,0.992332,0.992115,0.991894,0.991671,0.991445,0.991216,0.990983,0.990748,0.990509,0.990268,0.990024,0.989776,0.989526,0.989272,0.989016,0.988756,0.988494,0.988228,0.98796,0.987688,0.987414,0.987136,0.986856,0.986572,0.986286,0.985996,0.985703,0.985408,0.985109,0.984808,0.984503,0.984196,0.983885,0.983571,0.983255,0.982935,0.982613,0.982287,0.981959,0.981627,0.981293,0.980955,0.980615,0.980271,0.979925,0.979575,0.979223,0.978867,0.978509,0.978148,0.977783,0.977416,0.977046,0.976672,0.976296,0.975917,0.975535,0.975149,0.974761,0.97437,0.973976,0.973579,0.973179,0.972776,0.97237,0.971961,0.971549,0.971134,0.970716,0.970296,0.969872,0.969445,0.969016,0.968583,0.968148,0.967709,0.967268,0.966823,0.966376,0.965926,0.965473,0.965016,0.964557,0.964095,0.96363,0.963163,0.962692,0.962218,0.961741,0.961262,0.960779,0.960294,0.959805,0.959314,0.95882,0.958323,0.957822,0.957319,0.956814,0.956305,0.955793,0.955278,0.954761,0.95424,0.953717,0.953191,0.952661,0.952129,0.951594,0.951057,0.950516,0.949972,0.949425,0.948876,0.948324,0.947768,0.94721,0.946649,0.946085,0.945519,0.944949,0.944376,0.943801,0.943223,0.942641,0.942057,0.941471,0.940881,0.940288,0.939693,0.939094,0.938493,0.937889,0.937282,0.936672,0.93606,0.935444,0.934826,0.934204,0.93358,0.932954,0.932324,0.931691,0.931056,0.930418,0.929776,0.929133,0.928486,0.927836,0.927184,0.926529,0.925871,0.92521,0.924546,0.92388,0.92321,0.922538,0.921863,0.921185,0.920505,0.919821,0.919135,0.918446,0.917755,0.91706,0.916363,0.915663,0.91496,0.914254,0.913545,0.912834,0.91212,0.911403,0.910684,0.909961,0.909236,0.908508,0.907777,0.907044,0.906308,0.905569,0.904827,0.904083,0.903335,0.902585,0.901833,0.901077,0.900319,0.899558,0.898794,0.898028,0.897258,0.896486,0.895712,0.894934,0.894154,0.893371,0.892586,0.891798,0.891007,0.890213,0.889416,0.888617,0.887815,0.887011,0.886204,0.885394,0.884581,0.883766,0.882948,0.882127,0.881303,0.880477,0.879649,0.878817,0.877983,0.877146,0.876307,0.875465,0.87462,0.873772,0.872922,0.872069,0.871214,0.870356,0.869495,0.868632,0.867765,0.866897,0.866025,0.865151,0.864275,0.863396,0.862514,0.861629,0.860742,0.859852,0.85896,0.858065,0.857167,0.856267,0.855364,0.854459,0.853551,0.85264,0.851727,0.850811,0.849893,0.848972,0.848048,0.847122,0.846193,0.845262,0.844328,0.843391,0.842452,0.841511,0.840567,0.83962,0.838671,0.837719,0.836764,0.835807,0.834848,0.833886,0.832921,0.831954,0.830984,0.830012,0.829038,0.82806,0.827081,0.826098,0.825113,0.824126,0.823136,0.822144,0.821149,0.820152,0.819152,0.81815,0.817145,0.816138,0.815128,0.814116,0.813101,0.812084,0.811064,0.810042,0.809017,0.80799,0.80696,0.805928,0.804894,0.803857,0.802817,0.801776,0.800731,0.799685,0.798636,0.797584,0.79653,0.795473,0.794415,0.793353,0.79229,0.791224,0.790155,0.789084,0.788011,0.786935,0.785857,0.784776,0.783693,0.782608,0.78152,0.78043,0.779338,0.778243,0.777146,0.776046,0.774944,0.77384,0.772734,0.771625,0.770513,0.7694,0.768284,0.767165,0.766044,0.764921,0.763796,0.762668,0.761538,0.760406,0.759271,0.758134,0.756995,0.755853,0.75471,0.753563,0.752415,0.751264,0.750111,0.748956,0.747798,0.746638,0.745476,0.744312,0.743145,0.741976,0.740805,0.739631,0.738455,0.737277,0.736097,0.734915,0.73373,0.732543,0.731354,0.730162,0.728969,0.727773,0.726575,0.725374,0.724172,0.722967,0.72176,0.720551,0.71934,0.718126,0.716911,0.715693,0.714473,0.71325,0.712026,0.710799,0.709571,0.70834,0.707107,0.705872,0.704634,0.703395,0.702153,0.700909,0.699663,0.698415,0.697165,0.695913,0.694658,0.693402,0.692143,0.690882,0.68962,0.688355,0.687088,0.685818,0.684547,0.683274,0.681998,0.680721,0.679441,0.67816,0.676876,0.67559,0.674302,0.673013,0.671721,0.670427,0.669131,0.667833,0.666532,0.66523,0.663926,0.66262,0.661312,0.660002,0.658689,0.657375,0.656059,0.654741,0.653421,0.652098,0.650774,0.649448,0.64812,0.64679,0.645458,0.644124,0.642788,0.64145,0.64011,0.638768,0.637424,0.636078,0.634731,0.633381,0.632029,0.630676,0.62932,0.627963,0.626604,0.625243,0.62388,0.622515,0.621148,0.619779,0.618408,0.617036,0.615661,0.614285,0.612907,0.611527,0.610145,0.608761,0.607376,0.605988,0.604599,0.603208,0.601815,0.60042,0.599024,0.597625,0.596225,0.594823,0.593419,0.592013,0.590606,0.589196,0.587785,0.586372,0.584958,0.583541,0.582123,0.580703,0.579281,0.577858,0.576432,0.575005,0.573576,0.572146,0.570714,0.56928,0.567844,0.566406,0.564967,0.563526,0.562083,0.560639,0.559193,0.557745,0.556296,0.554844,0.553392,0.551937,0.550481,0.549023,0.547563,0.546102,0.544639,0.543174,0.541708,0.54024,0.538771,0.5373,0.535827,0.534352,0.532876,0.531399,0.529919,0.528438,0.526956,0.525472,0.523986,0.522499,0.52101,0.519519,0.518027,0.516533,0.515038,0.513541,0.512043,0.510543,0.509041,0.507538,0.506034,0.504528,0.50302,0.501511,0.5,0.498488,0.496974,0.495459,0.493942,0.492424,0.490904,0.489382,0.48786,0.486335,0.48481,0.483282,0.481754,0.480223,0.478692,0.477159,0.475624,0.474088,0.472551,0.471012,0.469472,0.46793,0.466387,0.464842,0.463296,0.461749,0.4602,0.45865,0.457098,0.455545,0.45399,0.452435,0.450878,0.449319,0.447759,0.446198,0.444635,0.443071,0.441506,0.439939,0.438371,0.436802,0.435231,0.433659,0.432086,0.430511,0.428935,0.427358,0.425779,0.424199,0.422618,0.421036,0.419452,0.417867,0.416281,0.414693,0.413104,0.411514,0.409923,0.40833,0.406737,0.405142,0.403545,0.401948,0.400349,0.398749,0.397148,0.395546,0.393942,0.392337,0.390731,0.389124,0.387516,0.385906,0.384295,0.382683,0.38107,0.379456,0.377841,0.376224,0.374607,0.372988,0.371368,0.369747,0.368125,0.366501,0.364877,0.363251,0.361625,0.359997,0.358368,0.356738,0.355107,0.353475,0.351842,0.350207,0.348572,0.346936,0.345298,0.34366,0.34202,0.34038,0.338738,0.337095,0.335452,0.333807,0.332161,0.330514,0.328867,0.327218,0.325568,0.323917,0.322266,0.320613,0.318959,0.317305,0.315649,0.313992,0.312335,0.310676,0.309017,0.307357,0.305695,0.304033,0.30237,0.300706,0.299041,0.297375,0.295708,0.29404,0.292372,0.290702,0.289032,0.287361,0.285688,0.284015,0.282341,0.280667,0.278991,0.277315,0.275637,0.273959,0.27228,0.2706,0.26892,0.267238,0.265556,0.263873,0.262189,0.260505,0.258819,0.257133,0.255446,0.253758,0.252069,0.25038,0.24869,0.246999,0.245307,0.243615,0.241922,0.240228,0.238533,0.236838,0.235142,0.233445,0.231748,0.23005,0.228351,0.226651,0.224951,0.22325,0.221548,0.219846,0.218143,0.21644,0.214735,0.21303,0.211325,0.209619,0.207912,0.206204,0.204496,0.202787,0.201078,0.199368,0.197657,0.195946,0.194234,0.192522,0.190809,0.189095,0.187381,0.185667,0.183951,0.182236,0.180519,0.178802,0.177085,0.175367,0.173648,0.171929,0.170209,0.168489,0.166769,0.165048,0.163326,0.161604,0.159881,0.158158,0.156434,0.15471,0.152986,0.151261,0.149535,0.147809,0.146083,0.144356,0.142629,0.140901,0.139173,0.137445,0.135716,0.133986,0.132256,0.130526,0.128796,0.127065,0.125333,0.123601,0.121869,0.120137,0.118404,0.116671,0.114937,0.113203,0.111469,0.109734,0.107999,0.106264,0.104528,0.102793,0.101056,0.0993197,0.0975829,0.0958458,0.0941083,0.0923706,0.0906326,0.0888943,0.0871557,0.0854169,0.0836778,0.0819385,0.0801989,0.0784591,0.076719,0.0749787,0.0732382,0.0714974,0.0697565,0.0680153,0.0662739,0.0645323,0.0627905,0.0610485,0.0593064,0.057564,0.0558215,0.0540788,0.052336,0.0505929,0.0488498,0.0471065,0.045363,0.0436194,0.0418757,0.0401318,0.0383878,0.0366437,0.0348995,0.0331552,0.0314108,0.0296662,0.0279216,0.0261769,0.0244322,0.0226873,0.0209424,0.0191974,0.0174524,0.0157073,0.0139622,0.012217,0.0104718,0.00872654,0.00698126,0.00523596,0.00349065,0.00174533,0,-0.00174533,-0.00349065,-0.00523596,-0.00698126,-0.00872654,-0.0104718,-0.012217,-0.0139622,-0.0157073,-0.0174524,-0.0191974,-0.0209424,-0.0226873,-0.0244322,-0.0261769,-0.0279216,-0.0296662,-0.0314108,-0.0331552,-0.0348995,-0.0366437,-0.0383878,-0.0401318,-0.0418757,-0.0436194,-0.045363,-0.0471065,-0.0488498,-0.0505929,-0.052336,-0.0540788,-0.0558215,-0.057564,-0.0593064,-0.0610485,-0.0627905,-0.0645323,-0.0662739,-0.0680153,-0.0697565,-0.0714974,-0.0732382,-0.0749787,-0.076719,-0.0784591,-0.0801989,-0.0819385,-0.0836778,-0.0854169,-0.0871557,-0.0888943,-0.0906326,-0.0923706,-0.0941083,-0.0958458,-0.0975829,-0.0993197,-0.101056,-0.102793,-0.104528,-0.106264,-0.107999,-0.109734,-0.111469,-0.113203,-0.114937,-0.116671,-0.118404,-0.120137,-0.121869,-0.123601,-0.125333,-0.127065,-0.128796,-0.130526,-0.132256,-0.133986,-0.135716,-0.137445,-0.139173,-0.140901,-0.142629,-0.144356,-0.146083,-0.147809,-0.149535,-0.151261,-0.152986,-0.15471,-0.156434,-0.158158,-0.159881,-0.161604,-0.163326,-0.165048,-0.166769,-0.168489,-0.170209,-0.171929,-0.173648,-0.175367,-0.177085,-0.178802,-0.180519,-0.182236,-0.183951,-0.185667,-0.187381,-0.189095,-0.190809,-0.192522,-0.194234,-0.195946,-0.197657,-0.199368,-0.201078,-0.202787,-0.204496,-0.206204,-0.207912,-0.209619,-0.211325,-0.21303,-0.214735,-0.21644,-0.218143,-0.219846,-0.221548,-0.22325,-0.224951,-0.226651,-0.228351,-0.23005,-0.231748,-0.233445,-0.235142,-0.236838,-0.238533,-0.240228,-0.241922,-0.243615,-0.245307,-0.246999,-0.24869,-0.25038,-0.252069,-0.253758,-0.255446,-0.257133,-0.258819,-0.260505,-0.262189,-0.263873,-0.265556,-0.267238,-0.26892,-0.2706,-0.27228,-0.273959,-0.275637,-0.277315,-0.278991,-0.280667,-0.282341,-0.284015,-0.285688,-0.287361,-0.289032,-0.290702,-0.292372,-0.29404,-0.295708,-0.297375,-0.299041,-0.300706,-0.30237,-0.304033,-0.305695,-0.307357,-0.309017,-0.310676,-0.312335,-0.313992,-0.315649,-0.317305,-0.318959,-0.320613,-0.322266,-0.323917,-0.325568,-0.327218,-0.328867,-0.330514,-0.332161,-0.333807,-0.335452,-0.337095,-0.338738,-0.34038,-0.34202,-0.34366,-0.345298,-0.346936,-0.348572,-0.350207,-0.351842,-0.353475,-0.355107,-0.356738,-0.358368,-0.359997,-0.361625,-0.363251,-0.364877,-0.366501,-0.368125,-0.369747,-0.371368,-0.372988,-0.374607,-0.376224,-0.377841,-0.379456,-0.38107,-0.382683,-0.384295,-0.385906,-0.387516,-0.389124,-0.390731,-0.392337,-0.393942,-0.395546,-0.397148,-0.398749,-0.400349,-0.401948,-0.403545,-0.405142,-0.406737,-0.40833,-0.409923,-0.411514,-0.413104,-0.414693,-0.416281,-0.417867,-0.419452,-0.421036,-0.422618,-0.424199,-0.425779,-0.427358,-0.428935,-0.430511,-0.432086,-0.433659,-0.435231,-0.436802,-0.438371,-0.439939,-0.441506,-0.443071,-0.444635,-0.446198,-0.447759,-0.449319,-0.450878,-0.452435,-0.45399,-0.455545,-0.457098,-0.45865,-0.4602,-0.461749,-0.463296,-0.464842,-0.466387,-0.46793,-0.469472,-0.471012,-0.472551,-0.474088,-0.475624,-0.477159,-0.478692,-0.480223,-0.481754,-0.483282,-0.48481,-0.486335,-0.48786,-0.489382,-0.490904,-0.492424,-0.493942,-0.495459,-0.496974,-0.498488,-0.5,-0.501511,-0.50302,-0.504528,-0.506034,-0.507538,-0.509041,-0.510543,-0.512043,-0.513541,-0.515038,-0.516533,-0.518027,-0.519519,-0.52101,-0.522499,-0.523986,-0.525472,-0.526956,-0.528438,-0.529919,-0.531399,-0.532876,-0.534352,-0.535827,-0.5373,-0.538771,-0.54024,-0.541708,-0.543174,-0.544639,-0.546102,-0.547563,-0.549023,-0.550481,-0.551937,-0.553392,-0.554844,-0.556296,-0.557745,-0.559193,-0.560639,-0.562083,-0.563526,-0.564967,-0.566406,-0.567844,-0.56928,-0.570714,-0.572146,-0.573576,-0.575005,-0.576432,-0.577858,-0.579281,-0.580703,-0.582123,-0.583541,-0.584958,-0.586372,-0.587785,-0.589196,-0.590606,-0.592013,-0.593419,-0.594823,-0.596225,-0.597625,-0.599024,-0.60042,-0.601815,-0.603208,-0.604599,-0.605988,-0.607376,-0.608761,-0.610145,-0.611527,-0.612907,-0.614285,-0.615661,-0.617036,-0.618408,-0.619779,-0.621148,-0.622515,-0.62388,-0.625243,-0.626604,-0.627963,-0.62932,-0.630676,-0.632029,-0.633381,-0.634731,-0.636078,-0.637424,-0.638768,-0.64011,-0.64145,-0.642788,-0.644124,-0.645458,-0.64679,-0.64812,-0.649448,-0.650774,-0.652098,-0.653421,-0.654741,-0.656059,-0.657375,-0.658689,-0.660002,-0.661312,-0.66262,-0.663926,-0.66523,-0.666532,-0.667833,-0.669131,-0.670427,-0.671721,-0.673013,-0.674302,-0.67559,-0.676876,-0.67816,-0.679441,-0.680721,-0.681998,-0.683274,-0.684547,-0.685818,-0.687088,-0.688355,-0.68962,-0.690882,-0.692143,-0.693402,-0.694658,-0.695913,-0.697165,-0.698415,-0.699663,-0.700909,-0.702153,-0.703395,-0.704634,-0.705872,-0.707107,-0.70834,-0.709571,-0.710799,-0.712026,-0.71325,-0.714473,-0.715693,-0.716911,-0.718126,-0.71934,-0.720551,-0.72176,-0.722967,-0.724172,-0.725374,-0.726575,-0.727773,-0.728969,-0.730162,-0.731354,-0.732543,-0.73373,-0.734915,-0.736097,-0.737277,-0.738455,-0.739631,-0.740805,-0.741976,-0.743145,-0.744312,-0.745476,-0.746638,-0.747798,-0.748956,-0.750111,-0.751264,-0.752415,-0.753563,-0.75471,-0.755853,-0.756995,-0.758134,-0.759271,-0.760406,-0.761538,-0.762668,-0.763796,-0.764921,-0.766044,-0.767165,-0.768284,-0.7694,-0.770513,-0.771625,-0.772734,-0.77384,-0.774944,-0.776046,-0.777146,-0.778243,-0.779338,-0.78043,-0.78152,-0.782608,-0.783693,-0.784776,-0.785857,-0.786935,-0.788011,-0.789084,-0.790155,-0.791224,-0.79229,-0.793353,-0.794415,-0.795473,-0.79653,-0.797584,-0.798636,-0.799685,-0.800731,-0.801776,-0.802817,-0.803857,-0.804894,-0.805928,-0.80696,-0.80799,-0.809017,-0.810042,-0.811064,-0.812084,-0.813101,-0.814116,-0.815128,-0.816138,-0.817145,-0.81815,-0.819152,-0.820152,-0.821149,-0.822144,-0.823136,-0.824126,-0.825113,-0.826098,-0.827081,-0.82806,-0.829038,-0.830012,-0.830984,-0.831954,-0.832921,-0.833886,-0.834848,-0.835807,-0.836764,-0.837719,-0.838671,-0.83962,-0.840567,-0.841511,-0.842452,-0.843391,-0.844328,-0.845262,-0.846193,-0.847122,-0.848048,-0.848972,-0.849893,-0.850811,-0.851727,-0.85264,-0.853551,-0.854459,-0.855364,-0.856267,-0.857167,-0.858065,-0.85896,-0.859852,-0.860742,-0.861629,-0.862514,-0.863396,-0.864275,-0.865151,-0.866025,-0.866897,-0.867765,-0.868632,-0.869495,-0.870356,-0.871214,-0.872069,-0.872922,-0.873772,-0.87462,-0.875465,-0.876307,-0.877146,-0.877983,-0.878817,-0.879649,-0.880477,-0.881303,-0.882127,-0.882948,-0.883766,-0.884581,-0.885394,-0.886204,-0.887011,-0.887815,-0.888617,-0.889416,-0.890213,-0.891007,-0.891798,-0.892586,-0.893371,-0.894154,-0.894934,-0.895712,-0.896486,-0.897258,-0.898028,-0.898794,-0.899558,-0.900319,-0.901077,-0.901833,-0.902585,-0.903335,-0.904083,-0.904827,-0.905569,-0.906308,-0.907044,-0.907777,-0.908508,-0.909236,-0.909961,-0.910684,-0.911403,-0.91212,-0.912834,-0.913545,-0.914254,-0.91496,-0.915663,-0.916363,-0.91706,-0.917755,-0.918446,-0.919135,-0.919821,-0.920505,-0.921185,-0.921863,-0.922538,-0.92321,-0.92388,-0.924546,-0.92521,-0.925871,-0.926529,-0.927184,-0.927836,-0.928486,-0.929133,-0.929776,-0.930418,-0.931056,-0.931691,-0.932324,-0.932954,-0.93358,-0.934204,-0.934826,-0.935444,-0.93606,-0.936672,-0.937282,-0.937889,-0.938493,-0.939094,-0.939693,-0.940288,-0.940881,-0.941471,-0.942057,-0.942641,-0.943223,-0.943801,-0.944376,-0.944949,-0.945519,-0.946085,-0.946649,-0.94721,-0.947768,-0.948324,-0.948876,-0.949425,-0.949972,-0.950516,-0.951057,-0.951594,-0.952129,-0.952661,-0.953191,-0.953717,-0.95424,-0.954761,-0.955278,-0.955793,-0.956305,-0.956814,-0.957319,-0.957822,-0.958323,-0.95882,-0.959314,-0.959805,-0.960294,-0.960779,-0.961262,-0.961741,-0.962218,-0.962692,-0.963163,-0.96363,-0.964095,-0.964557,-0.965016,-0.965473,-0.965926,-0.966376,-0.966823,-0.967268,-0.967709,-0.968148,-0.968583,-0.969016,-0.969445,-0.969872,-0.970296,-0.970716,-0.971134,-0.971549,-0.971961,-0.97237,-0.972776,-0.973179,-0.973579,-0.973976,-0.97437,-0.974761,-0.975149,-0.975535,-0.975917,-0.976296,-0.976672,-0.977046,-0.977416,-0.977783,-0.978148,-0.978509,-0.978867,-0.979223,-0.979575,-0.979925,-0.980271,-0.980615,-0.980955,-0.981293,-0.981627,-0.981959,-0.982287,-0.982613,-0.982935,-0.983255,-0.983571,-0.983885,-0.984196,-0.984503,-0.984808,-0.985109,-0.985408,-0.985703,-0.985996,-0.986286,-0.986572,-0.986856,-0.987136,-0.987414,-0.987688,-0.98796,-0.988228,-0.988494,-0.988756,-0.989016,-0.989272,-0.989526,-0.989776,-0.990024,-0.990268,-0.990509,-0.990748,-0.990983,-0.991216,-0.991445,-0.991671,-0.991894,-0.992115,-0.992332,-0.992546,-0.992757,-0.992966,-0.993171,-0.993373,-0.993572,-0.993768,-0.993961,-0.994151,-0.994338,-0.994522,-0.994703,-0.994881,-0.995056,-0.995227,-0.995396,-0.995562,-0.995725,-0.995884,-0.996041,-0.996195,-0.996345,-0.996493,-0.996637,-0.996779,-0.996917,-0.997053,-0.997185,-0.997314,-0.997441,-0.997564,-0.997684,-0.997801,-0.997916,-0.998027,-0.998135,-0.99824,-0.998342,-0.998441,-0.998537,-0.99863,-0.998719,-0.998806,-0.99889,-0.998971,-0.999048,-0.999123,-0.999194,-0.999263,-0.999328,-0.999391,-0.99945,-0.999507,-0.99956,-0.99961,-0.999657,-0.999701,-0.999743,-0.999781,-0.999816,-0.999848,-0.999877,-0.999903,-0.999925,-0.999945,-0.999962,-0.999976,-0.999986,-0.999994,-0.999998,-1,-0.999998,-0.999994,-0.999986,-0.999976,-0.999962,-0.999945,-0.999925,-0.999903,-0.999877,-0.999848,-0.999816,-0.999781,-0.999743,-0.999701,-0.999657,-0.99961,-0.99956,-0.999507,-0.99945,-0.999391,-0.999328,-0.999263,-0.999194,-0.999123,-0.999048,-0.998971,-0.99889,-0.998806,-0.998719,-0.99863,-0.998537,-0.998441,-0.998342,-0.99824,-0.998135,-0.998027,-0.997916,-0.997801,-0.997684,-0.997564,-0.997441,-0.997314,-0.997185,-0.997053,-0.996917,-0.996779,-0.996637,-0.996493,-0.996345,-0.996195,-0.996041,-0.995884,-0.995725,-0.995562,-0.995396,-0.995227,-0.995056,-0.994881,-0.994703,-0.994522,-0.994338,-0.994151,-0.993961,-0.993768,-0.993572,-0.993373,-0.993171,-0.992966,-0.992757,-0.992546,-0.992332,-0.992115,-0.991894,-0.991671,-0.991445,-0.991216,-0.990983,-0.990748,-0.990509,-0.990268,-0.990024,-0.989776,-0.989526,-0.989272,-0.989016,-0.988756,-0.988494,-0.988228,-0.98796,-0.987688,-0.987414,-0.987136,-0.986856,-0.986572,-0.986286,-0.985996,-0.985703,-0.985408,-0.985109,-0.984808,-0.984503,-0.984196,-0.983885,-0.983571,-0.983255,-0.982935,-0.982613,-0.982287,-0.981959,-0.981627,-0.981293,-0.980955,-0.980615,-0.980271,-0.979925,-0.979575,-0.979223,-0.978867,-0.978509,-0.978148,-0.977783,-0.977416,-0.977046,-0.976672,-0.976296,-0.975917,-0.975535,-0.975149,-0.974761,-0.97437,-0.973976,-0.973579,-0.973179,-0.972776,-0.97237,-0.971961,-0.971549,-0.971134,-0.970716,-0.970296,-0.969872,-0.969445,-0.969016,-0.968583,-0.968148,-0.967709,-0.967268,-0.966823,-0.966376,-0.965926,-0.965473,-0.965016,-0.964557,-0.964095,-0.96363,-0.963163,-0.962692,-0.962218,-0.961741,-0.961262,-0.960779,-0.960294,-0.959805,-0.959314,-0.95882,-0.958323,-0.957822,-0.957319,-0.956814,-0.956305,-0.955793,-0.955278,-0.954761,-0.95424,-0.953717,-0.953191,-0.952661,-0.952129,-0.951594,-0.951057,-0.950516,-0.949972,-0.949425,-0.948876,-0.948324,-0.947768,-0.94721,-0.946649,-0.946085,-0.945519,-0.944949,-0.944376,-0.943801,-0.943223,-0.942641,-0.942057,-0.941471,-0.940881,-0.940288,-0.939693,-0.939094,-0.938493,-0.937889,-0.937282,-0.936672,-0.93606,-0.935444,-0.934826,-0.934204,-0.93358,-0.932954,-0.932324,-0.931691,-0.931056,-0.930418,-0.929776,-0.929133,-0.928486,-0.927836,-0.927184,-0.926529,-0.925871,-0.92521,-0.924546,-0.92388,-0.92321,-0.922538,-0.921863,-0.921185,-0.920505,-0.919821,-0.919135,-0.918446,-0.917755,-0.91706,-0.916363,-0.915663,-0.91496,-0.914254,-0.913545,-0.912834,-0.91212,-0.911403,-0.910684,-0.909961,-0.909236,-0.908508,-0.907777,-0.907044,-0.906308,-0.905569,-0.904827,-0.904083,-0.903335,-0.902585,-0.901833,-0.901077,-0.900319,-0.899558,-0.898794,-0.898028,-0.897258,-0.896486,-0.895712,-0.894934,-0.894154,-0.893371,-0.892586,-0.891798,-0.891007,-0.890213,-0.889416,-0.888617,-0.887815,-0.887011,-0.886204,-0.885394,-0.884581,-0.883766,-0.882948,-0.882127,-0.881303,-0.880477,-0.879649,-0.878817,-0.877983,-0.877146,-0.876307,-0.875465,-0.87462,-0.873772,-0.872922,-0.872069,-0.871214,-0.870356,-0.869495,-0.868632,-0.867765,-0.866897,-0.866025,-0.865151,-0.864275,-0.863396,-0.862514,-0.861629,-0.860742,-0.859852,-0.85896,-0.858065,-0.857167,-0.856267,-0.855364,-0.854459,-0.853551,-0.85264,-0.851727,-0.850811,-0.849893,-0.848972,-0.848048,-0.847122,-0.846193,-0.845262,-0.844328,-0.843391,-0.842452,-0.841511,-0.840567,-0.83962,-0.838671,-0.837719,-0.836764,-0.835807,-0.834848,-0.833886,-0.832921,-0.831954,-0.830984,-0.830012,-0.829038,-0.82806,-0.827081,-0.826098,-0.825113,-0.824126,-0.823136,-0.822144,-0.821149,-0.820152,-0.819152,-0.81815,-0.817145,-0.816138,-0.815128,-0.814116,-0.813101,-0.812084,-0.811064,-0.810042,-0.809017,-0.80799,-0.80696,-0.805928,-0.804894,-0.803857,-0.802817,-0.801776,-0.800731,-0.799685,-0.798636,-0.797584,-0.79653,-0.795473,-0.794415,-0.793353,-0.79229,-0.791224,-0.790155,-0.789084,-0.788011,-0.786935,-0.785857,-0.784776,-0.783693,-0.782608,-0.78152,-0.78043,-0.779338,-0.778243,-0.777146,-0.776046,-0.774944,-0.77384,-0.772734,-0.771625,-0.770513,-0.7694,-0.768284,-0.767165,-0.766044,-0.764921,-0.763796,-0.762668,-0.761538,-0.760406,-0.759271,-0.758134,-0.756995,-0.755853,-0.75471,-0.753563,-0.752415,-0.751264,-0.750111,-0.748956,-0.747798,-0.746638,-0.745476,-0.744312,-0.743145,-0.741976,-0.740805,-0.739631,-0.738455,-0.737277,-0.736097,-0.734915,-0.73373,-0.732543,-0.731354,-0.730162,-0.728969,-0.727773,-0.726575,-0.725374,-0.724172,-0.722967,-0.72176,-0.720551,-0.71934,-0.718126,-0.716911,-0.715693,-0.714473,-0.71325,-0.712026,-0.710799,-0.709571,-0.70834,-0.707107,-0.705872,-0.704634,-0.703395,-0.702153,-0.700909,-0.699663,-0.698415,-0.697165,-0.695913,-0.694658,-0.693402,-0.692143,-0.690882,-0.68962,-0.688355,-0.687088,-0.685818,-0.684547,-0.683274,-0.681998,-0.680721,-0.679441,-0.67816,-0.676876,-0.67559,-0.674302,-0.673013,-0.671721,-0.670427,-0.669131,-0.667833,-0.666532,-0.66523,-0.663926,-0.66262,-0.661312,-0.660002,-0.658689,-0.657375,-0.656059,-0.654741,-0.653421,-0.652098,-0.650774,-0.649448,-0.64812,-0.64679,-0.645458,-0.644124,-0.642788,-0.64145,-0.64011,-0.638768,-0.637424,-0.636078,-0.634731,-0.633381,-0.632029,-0.630676,-0.62932,-0.627963,-0.626604,-0.625243,-0.62388,-0.622515,-0.621148,-0.619779,-0.618408,-0.617036,-0.615661,-0.614285,-0.612907,-0.611527,-0.610145,-0.608761,-0.607376,-0.605988,-0.604599,-0.603208,-0.601815,-0.60042,-0.599024,-0.597625,-0.596225,-0.594823,-0.593419,-0.592013,-0.590606,-0.589196,-0.587785,-0.586372,-0.584958,-0.583541,-0.582123,-0.580703,-0.579281,-0.577858,-0.576432,-0.575005,-0.573576,-0.572146,-0.570714,-0.56928,-0.567844,-0.566406,-0.564967,-0.563526,-0.562083,-0.560639,-0.559193,-0.557745,-0.556296,-0.554844,-0.553392,-0.551937,-0.550481,-0.549023,-0.547563,-0.546102,-0.544639,-0.543174,-0.541708,-0.54024,-0.538771,-0.5373,-0.535827,-0.534352,-0.532876,-0.531399,-0.529919,-0.528438,-0.526956,-0.525472,-0.523986,-0.522499,-0.52101,-0.519519,-0.518027,-0.516533,-0.515038,-0.513541,-0.512043,-0.510543,-0.509041,-0.507538,-0.506034,-0.504528,-0.50302,-0.501511,-0.5,-0.498488,-0.496974,-0.495459,-0.493942,-0.492424,-0.490904,-0.489382,-0.48786,-0.486335,-0.48481,-0.483282,-0.481754,-0.480223,-0.478692,-0.477159,-0.475624,-0.474088,-0.472551,-0.471012,-0.469472,-0.46793,-0.466387,-0.464842,-0.463296,-0.461749,-0.4602,-0.45865,-0.457098,-0.455545,-0.45399,-0.452435,-0.450878,-0.449319,-0.447759,-0.446198,-0.444635,-0.443071,-0.441506,-0.439939,-0.438371,-0.436802,-0.435231,-0.433659,-0.432086,-0.430511,-0.428935,-0.427358,-0.425779,-0.424199,-0.422618,-0.421036,-0.419452,-0.417867,-0.416281,-0.414693,-0.413104,-0.411514,-0.409923,-0.40833,-0.406737,-0.405142,-0.403545,-0.401948,-0.400349,-0.398749,-0.397148,-0.395546,-0.393942,-0.392337,-0.390731,-0.389124,-0.387516,-0.385906,-0.384295,-0.382683,-0.38107,-0.379456,-0.377841,-0.376224,-0.374607,-0.372988,-0.371368,-0.369747,-0.368125,-0.366501,-0.364877,-0.363251,-0.361625,-0.359997,-0.358368,-0.356738,-0.355107,-0.353475,-0.351842,-0.350207,-0.348572,-0.346936,-0.345298,-0.34366,-0.34202,-0.34038,-0.338738,-0.337095,-0.335452,-0.333807,-0.332161,-0.330514,-0.328867,-0.327218,-0.325568,-0.323917,-0.322266,-0.320613,-0.318959,-0.317305,-0.315649,-0.313992,-0.312335,-0.310676,-0.309017,-0.307357,-0.305695,-0.304033,-0.30237,-0.300706,-0.299041,-0.297375,-0.295708,-0.29404,-0.292372,-0.290702,-0.289032,-0.287361,-0.285688,-0.284015,-0.282341,-0.280667,-0.278991,-0.277315,-0.275637,-0.273959,-0.27228,-0.2706,-0.26892,-0.267238,-0.265556,-0.263873,-0.262189,-0.260505,-0.258819,-0.257133,-0.255446,-0.253758,-0.252069,-0.25038,-0.24869,-0.246999,-0.245307,-0.243615,-0.241922,-0.240228,-0.238533,-0.236838,-0.235142,-0.233445,-0.231748,-0.23005,-0.228351,-0.226651,-0.224951,-0.22325,-0.221548,-0.219846,-0.218143,-0.21644,-0.214735,-0.21303,-0.211325,-0.209619,-0.207912,-0.206204,-0.204496,-0.202787,-0.201078,-0.199368,-0.197657,-0.195946,-0.194234,-0.192522,-0.190809,-0.189095,-0.187381,-0.185667,-0.183951,-0.182236,-0.180519,-0.178802,-0.177085,-0.175367,-0.173648,-0.171929,-0.170209,-0.168489,-0.166769,-0.165048,-0.163326,-0.161604,-0.159881,-0.158158,-0.156434,-0.15471,-0.152986,-0.151261,-0.149535,-0.147809,-0.146083,-0.144356,-0.142629,-0.140901,-0.139173,-0.137445,-0.135716,-0.133986,-0.132256,-0.130526,-0.128796,-0.127065,-0.125333,-0.123601,-0.121869,-0.120137,-0.118404,-0.116671,-0.114937,-0.113203,-0.111469,-0.109734,-0.107999,-0.106264,-0.104528,-0.102793,-0.101056,-0.0993197,-0.0975829,-0.0958458,-0.0941083,-0.0923706,-0.0906326,-0.0888943,-0.0871557,-0.0854169,-0.0836778,-0.0819385,-0.0801989,-0.0784591,-0.076719,-0.0749787,-0.0732382,-0.0714974,-0.0697565,-0.0680153,-0.0662739,-0.0645323,-0.0627905,-0.0610485,-0.0593064,-0.057564,-0.0558215,-0.0540788,-0.052336,-0.0505929,-0.0488498,-0.0471065,-0.045363,-0.0436194,-0.0418757,-0.0401318,-0.0383878,-0.0366437,-0.0348995,-0.0331552,-0.0314108,-0.0296662,-0.0279216,-0.0261769,-0.0244322,-0.0226873,-0.0209424,-0.0191974,-0.0174524,-0.0157073,-0.0139622,-0.012217,-0.0104718,-0.00872654,-0.00698126,-0.00523596,-0.00349065,-0.00174533
};

const float ATanBox[1000]=
{
	0.001000,0.002000,0.003000,0.004000,0.005000,0.006000,0.007000,0.008000,0.009000,0.010000,0.011000,0.011999,0.012999,0.013999,0.014999,0.015999,0.016998,0.017998,0.018998,0.019997,0.020997,0.021996,0.022996,0.023995,0.024995,0.025994,0.026993,0.027993,0.028992,0.029991,0.030990,0.031989,0.032988,0.033987,0.034986,0.035984,0.036983,0.037982,0.038980,0.039979,0.040977,0.041975,0.042974,0.043972,0.044970,0.045968,0.046965,0.047963,0.048961,0.049958,0.050956,0.051953,0.052950,0.053948,0.054945,0.055942,0.056938,0.057935,0.058932,0.059928,0.060925,0.061921,0.062917,0.063913,0.064909,0.065904,0.066900,0.067895,0.068891,0.069886,0.070881,0.071876,0.072871,0.073865,0.074860,0.075854,0.076848,0.077842,0.078836,0.079830,0.080824,0.081817,0.082810,0.083803,0.084796,0.085789,0.086781,0.087774,0.088766,0.089758,0.090750,0.091742,0.092733,0.093725,0.094716,0.095707,0.096697,0.097688,0.098678,0.099669,0.100659,0.101648,0.102638,0.103627,0.104617,0.105606,0.106594,0.107583,0.108571,0.109560,0.110547,0.111535,0.112523,0.113510,0.114497,0.115484,0.116470,0.117457,0.118443,0.119429,0.120415,0.121400,0.122385,0.123370,0.124355,0.125339,0.126324,0.127308,0.128291,0.129275,0.130258,0.131241,0.132224,0.133206,0.134189,0.135171,0.136152,0.137134,0.138115,0.139096,0.140077,0.141057,0.142037,0.143017,0.143996,0.144976,0.145955,0.146933,0.147912,0.148890,0.149868,0.150845,0.151823,0.152800,0.153776,0.154753,0.155729,0.156705,0.157680,0.158655,0.159630,0.160605,0.161579,0.162553,0.163527,0.164500,0.165473,0.166446,0.167418,0.168390,0.169362,0.170333,0.171304,0.172275,0.173246,0.174216,0.175186,0.176155,0.177124,0.178093,0.179061,0.180029,0.180997,0.181965,0.182932,0.183899,0.184865,0.185831,0.186797,0.187762,0.188727,0.189692,0.190656,0.191620,0.192583,0.193546,0.194509,0.195472,0.196434,0.197396,0.198357,0.199318,0.200279,0.201239,0.202199,0.203158,0.204117,0.205076,0.206034,0.206992,0.207950,0.208907,0.209864,0.210820,0.211776,0.212732,0.213687,0.214642,0.215596,0.216550,0.217504,0.218457,0.219410,0.220362,0.221314,0.222266,0.223217,0.224168,0.225118,0.226068,0.227018,0.227967,0.228916,0.229864,0.230812,0.231759,0.232706,0.233653,0.234599,0.235545,0.236490,0.237435,0.238380,0.239324,0.240267,0.241210,0.242153,0.243095,0.244037,0.244979,0.245920,0.246860,0.247800,0.248740,0.249679,0.250618,0.251556,0.252494,0.253431,0.254368,0.255305,0.256241,0.257176,0.258111,0.259046,0.259980,0.260914,0.261847,0.262780,0.263712,0.264644,0.265575,0.266506,0.267436,0.268366,0.269296,0.270225,0.271153,0.272081,0.273009,0.273936,0.274862,0.275788,0.276714,0.277639,0.278564,0.279488,0.280412,0.281335,0.282257,0.283180,0.284101,0.285022,0.285943,0.286863,0.287783,0.288702,0.289621,0.290539,0.291457,0.292374,0.293291,0.294207,0.295122,0.296038,0.296952,0.297866,0.298780,0.299693,0.300606,0.301518,0.302429,0.303340,0.304251,0.305161,0.306070,0.306979,0.307888,0.308796,0.309703,0.310610,0.311516,0.312422,0.313327,0.314232,0.315136,0.316040,0.316943,0.317845,0.318748,0.319649,0.320550,0.321451,0.322350,0.323250,0.324149,0.325047,0.325945,0.326842,0.327739,0.328635,0.329530,0.330425,0.331320,0.332214,0.333107,0.334000,0.334892,0.335784,0.336675,0.337565,0.338455,0.339345,0.340234,0.341122,0.342010,0.342897,0.343784,0.344670,0.345556,0.346441,0.347325,0.348209,0.349092,0.349975,0.350857,0.351739,0.352620,0.353500,0.354380,0.355259,0.356138,0.357016,0.357894,0.358771,0.359647,0.360523,0.361398,0.362273,0.363147,0.364021,0.364893,0.365766,0.366638,0.367509,0.368379,0.369249,0.370119,0.370988,0.371856,0.372724,0.373591,0.374457,0.375323,0.376189,0.377053,0.377917,0.378781,0.379644,0.380506,0.381368,0.382229,0.383090,0.383950,0.384809,0.385668,0.386526,0.387384,0.388241,0.389097,0.389953,0.390808,0.391663,0.392517,0.393370,0.394223,0.395075,0.395927,0.396778,0.397628,0.398478,0.399327,0.400175,0.401023,0.401871,0.402717,0.403563,0.404409,0.405254,0.406098,0.406942,0.407785,0.408627,0.409469,0.410310,0.411151,0.411991,0.412830,0.413669,0.414507,0.415344,0.416181,0.417017,0.417853,0.418688,0.419523,0.420356,0.421189,0.422022,0.422854,0.423685,0.424516,0.425346,0.426175,0.427004,0.427832,0.428660,0.429487,0.430313,0.431139,0.431964,0.432788,0.433612,0.434435,0.435258,0.436080,0.436901,0.437721,0.438542,0.439361,0.440180,0.440998,0.441815,0.442632,0.443448,0.444264,0.445079,0.445893,0.446707,0.447520,0.448332,0.449144,0.449955,0.450766,0.451576,0.452385,0.453194,0.454002,0.454809,0.455616,0.456422,0.457227,0.458032,0.458836,0.459640,0.460442,0.461245,0.462046,0.462847,0.463648,0.464447,0.465246,0.466045,0.466842,0.467640,0.468436,0.469232,0.470027,0.470822,0.471616,0.472409,0.473201,0.473993,0.474785,0.475575,0.476366,0.477155,0.477944,0.478732,0.479519,0.480306,0.481092,0.481878,0.482663,0.483447,0.484231,0.485014,0.485796,0.486578,0.487359,0.488139,0.488919,0.489698,0.490476,0.491254,0.492031,0.492808,0.493584,0.494359,0.495133,0.495907,0.496680,0.497453,0.498225,0.498996,0.499767,0.500537,0.501306,0.502075,0.502843,0.503611,0.504377,0.505144,0.505909,0.506674,0.507438,0.508202,0.508964,0.509727,0.510488,0.511249,0.512010,0.512769,0.513528,0.514287,0.515044,0.515801,0.516558,0.517313,0.518069,0.518823,0.519577,0.520330,0.521082,0.521834,0.522585,0.523336,0.524086,0.524835,0.525584,0.526332,0.527079,0.527826,0.528572,0.529317,0.530062,0.530806,0.531549,0.532292,0.533034,0.533776,0.534516,0.535257,0.535996,0.536735,0.537473,0.538211,0.538948,0.539684,0.540420,0.541154,0.541889,0.542622,0.543355,0.544088,0.544820,0.545551,0.546281,0.547011,0.547740,0.548468,0.549196,0.549924,0.550650,0.551376,0.552101,0.552826,0.553550,0.554273,0.554996,0.555718,0.556439,0.557160,0.557880,0.558599,0.559318,0.560036,0.560754,0.561471,0.562187,0.562902,0.563617,0.564331,0.565045,0.565758,0.566470,0.567182,0.567893,0.568603,0.569313,0.570022,0.570731,0.571439,0.572146,0.572852,0.573558,0.574263,0.574968,0.575672,0.576375,0.577078,0.577780,0.578481,0.579182,0.579882,0.580582,0.581280,0.581979,0.582676,0.583373,0.584069,0.584765,0.585460,0.586154,0.586848,0.587541,0.588233,0.588925,0.589616,0.590307,0.590997,0.591686,0.592374,0.593062,0.593750,0.594436,0.595122,0.595808,0.596493,0.597177,0.597860,0.598543,0.599225,0.599907,0.600588,0.601268,0.601948,0.602627,0.603305,0.603983,0.604660,0.605337,0.606013,0.606688,0.607362,0.608036,0.608710,0.609382,0.610055,0.610726,0.611397,0.612067,0.612737,0.613405,0.614074,0.614741,0.615409,0.616075,0.616741,0.617406,0.618070,0.618734,0.619398,0.620060,0.620722,0.621384,0.622044,0.622705,0.623364,0.624023,0.624681,0.625339,0.625996,0.626652,0.627308,0.627963,0.628618,0.629272,0.629925,0.630578,0.631230,0.631881,0.632532,0.633182,0.633832,0.634481,0.635129,0.635777,0.636424,0.637070,0.637716,0.638361,0.639006,0.639650,0.640293,0.640936,0.641578,0.642220,0.642861,0.643501,0.644141,0.644780,0.645418,0.646056,0.646693,0.647330,0.647966,0.648601,0.649236,0.649870,0.650504,0.651137,0.651769,0.652401,0.653032,0.653663,0.654293,0.654922,0.655551,0.656179,0.656806,0.657433,0.658059,0.658685,0.659310,0.659935,0.660558,0.661182,0.661804,0.662426,0.663048,0.663669,0.664289,0.664908,0.665527,0.666146,0.666764,0.667381,0.667998,0.668614,0.669229,0.669844,0.670458,0.671072,0.671685,0.672297,0.672909,0.673520,0.674131,0.674741,0.675350,0.675959,0.676568,0.677175,0.677782,0.678389,0.678995,0.679600,0.680205,0.680809,0.681412,0.682015,0.682618,0.683219,0.683821,0.684421,0.685021,0.685621,0.686219,0.686818,0.687415,0.688012,0.688609,0.689205,0.689800,0.690395,0.690989,0.691582,0.692175,0.692768,0.693360,0.693951,0.694542,0.695132,0.695721,0.696310,0.696898,0.697486,0.698073,0.698660,0.699246,0.699831,0.700416,0.701000,0.701584,0.702167,0.702750,0.703332,0.703913,0.704494,0.705074,0.705654,0.706233,0.706812,0.707390,0.707967,0.708544,0.709120,0.709696,0.710271,0.710846,0.711420,0.711993,0.712566,0.713138,0.713710,0.714281,0.714852,0.715422,0.715991,0.716560,0.717128,0.717696,0.718263,0.718830,0.719396,0.719962,0.720527,0.721091,0.721655,0.722218,0.722781,0.723343,0.723905,0.724466,0.725026,0.725586,0.726146,0.726704,0.727263,0.727820,0.728378,0.728934,0.729490,0.730046,0.730601,0.731155,0.731709,0.732262,0.732815,0.733367,0.733919,0.734470,0.735021,0.735571,0.736120,0.736669,0.737217,0.737765,0.738313,0.738859,0.739406,0.739951,0.740496,0.741041,0.741585,0.742128,0.742671,0.743214,0.743756,0.744297,0.744838,0.745378,0.745918,0.746457,0.746995,0.747534,0.748071,0.748608,0.749145,0.749681,0.750216,0.750751,0.751285,0.751819,0.752352,0.752885,0.753417,0.753949,0.754480,0.755011,0.755541,0.756070,0.756600,0.757128,0.757656,0.758184,0.758710,0.759237,0.759763,0.760288,0.760813,0.761337,0.761861,0.762384,0.762907,0.763429,0.763951,0.764472,0.764993,0.765513,0.766033,0.766552,0.767070,0.767588,0.768106,0.768623,0.769139,0.769655,0.770171,0.770686,0.771200,0.771714,0.772228,0.772741,0.773253,0.773765,0.774276,0.774787,0.775297,0.775807,0.776317,0.776826,0.777334,0.777842,0.778349,0.778856,0.779362,0.779868,0.780373,0.780878,0.781382,0.781886,0.782389,0.782892,0.783394,0.783896,0.784397,0.784898,0.785398
};

/**
  * @brief  Lookup table for Sin
  * @param  None
  * @retval None
  */
float SIN( int pos )
{
	
	while(pos<0)
		pos=pos+3600;
    pos = pos%3600;
	return SinBox[pos];
}
/**
  * @brief  Lookup table for Cos
  * @param  None
  * @retval None
  */
float COS( int pos )
{
	while(pos<0)
		pos=pos+3600;
    pos = pos%3600;
	return SIN(900-pos);
}

/**
  * @brief  Lookup table for atan
  * @param  None
  * @retval None
  */
float ATAN( int x, int y )
{
	if( x==0||y==0 )
	{
		if(x==0&&y==0)
		{
			return 0;
		}
		else if( x==0 )
		{
			if( y>0 )
			{
				return PI/2;
			}
			else//y<0
			{
				return 3*PI/2;
			}
		}
		else if( y==0 )
		{
			if( x>0 )
			{
				return 0;
			}
			else
			{
				return PI;
			}
		}
	}
	else if( x>0&&y>0 )//First
	{
		if( y<=x )
		{
			return ATanBox[y*1000/x-1];
		}
		else//x<y
		{
			return PI/2-ATanBox[x*1000/y-1];
		}
	}
	else if( x<0&&y>0 )//Second
	{
		if( -x <= y )
		{
			return PI/2+ATanBox[-x*1000/y-1];
		}
		else//y<-x
		{
			return PI-ATanBox[y*1000/(-x)-1];
		}
	}
	else if( x<0&&y<0 )//Third
	{
		if( -y < -x )
		{
			return PI+ATanBox[y*1000/x-1];
		}
		else// -x < -y
		{
			return 3*PI/2-ATanBox[x*1000/y-1];
		}
	}
	else if( x>0&&y<0 )
	{
		if( x<-y )
		{
			return 3*PI/2+ATanBox[-x*1000/y-1];
		}
		else//-y<x
		{
			return 2*PI-ATanBox[-y*1000/x-1];
		}
	}
	return 0;
}

void currentLoopInit( void )
{
	Current.IA_Offset = 2048;
	Current.IB_Offset = 2048;
	
	Current.dPI.kp = 1000;
	Current.dPI.ki = 1;
	Current.dPI.scale = 100;
	Current.dPI.output_max = 4000;
	Current.dPI.output_min = -4000;
	Current.dPI.sum_error_max = 4000*Current.dPI.scale;
	
	Current.qPI.kp = 1000;
	Current.qPI.ki = 1;
	Current.qPI.scale = 100;
	Current.qPI.output_max = 4000;
	Current.qPI.output_min = -4000;
	Current.qPI.sum_error_max = 4000*Current.qPI.scale;
	
	Current.targetCurrent = 0;
	Current.Id_exp = 0;
	Current.Iq_exp = 0;
}


void runSVPWM( int Vref, float theta )
{
	//Limit to sqrt(3)/3*Vref
	if( Vref >= Tz*0.866 )
		SVPWM.Vref = Tz*0.866;
	else
		SVPWM.Vref = Vref;
	
	SVPWM.Vdc = Tz;
	SVPWM.Theta = theta;
	SVPWM.Alpha = SVPWM.Theta*1800/PI;
	SVPWM.Sector = (int)(SVPWM.Alpha/600)%6+1;
	switch(SVPWM.Sector)
	{
		case 1:		
			SVPWM.T1 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(1800/3-SVPWM.Alpha)/SIN(1800/3);
			SVPWM.T2 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(SVPWM.Alpha)/SIN(1800/3);
			SVPWM.T0 = Tz-SVPWM.T1-SVPWM.T2;
			
			SVPWM.PWM1 = SVPWM.T1+SVPWM.T2+SVPWM.T0/2;
			SVPWM.PWM2 = SVPWM.T2+SVPWM.T0/2;
			SVPWM.PWM3 = SVPWM.T0/2;
			break;
		case 2:
			SVPWM.T1 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(1800/3-SVPWM.Alpha+1*1800/3)/SIN(1800/3);
			SVPWM.T2 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(SVPWM.Alpha-1800/3)/SIN(1800/3);			
			SVPWM.T0 = Tz-SVPWM.T1-SVPWM.T2;
			
			SVPWM.PWM1 = SVPWM.T1+SVPWM.T0/2;
			SVPWM.PWM2 = SVPWM.T1+SVPWM.T2+SVPWM.T0/2;
			SVPWM.PWM3 = SVPWM.T0/2;			
			break;
		case 3:
			SVPWM.T1 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(1800/3-SVPWM.Alpha+2*1800/3)/SIN(1800/3);
			SVPWM.T2 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(SVPWM.Alpha-2*1800/3)/SIN(1800/3);			
			SVPWM.T0 = Tz-SVPWM.T1-SVPWM.T2;		
			
			SVPWM.PWM1 = SVPWM.T0/2;
			SVPWM.PWM2 = SVPWM.T1+SVPWM.T2+SVPWM.T0/2;
			SVPWM.PWM3 = SVPWM.T2+SVPWM.T0/2;			
			break;
		case 4:
			SVPWM.T1 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(1800/3-SVPWM.Alpha+3*1800/3)/SIN(1800/3);
			SVPWM.T2 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(SVPWM.Alpha-3*1800/3)/SIN(1800/3);			
			SVPWM.T0 = Tz-SVPWM.T1-SVPWM.T2;			
			
			SVPWM.PWM1 = SVPWM.T0/2;
			SVPWM.PWM2 = SVPWM.T1+SVPWM.T0/2;
			SVPWM.PWM3 = SVPWM.T1+SVPWM.T2+SVPWM.T0/2;			
			break;
		case 5:
			SVPWM.T1 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(1800/3-SVPWM.Alpha+4*1800/3)/SIN(1800/3);
			SVPWM.T2 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(SVPWM.Alpha-4*1800/3)/SIN(1800/3);			
			SVPWM.T0 = Tz-SVPWM.T1-SVPWM.T2;			
			
			SVPWM.PWM1 = SVPWM.T2+SVPWM.T0/2;
			SVPWM.PWM2 = SVPWM.T0/2;
			SVPWM.PWM3 = SVPWM.T1+SVPWM.T2+SVPWM.T0/2;			
			break;
		case 6:
			SVPWM.T1 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(1800/3-SVPWM.Alpha+5*1800/3)/SIN(1800/3);
			SVPWM.T2 = Tz*SVPWM.Vref/SVPWM.Vdc*SIN(SVPWM.Alpha-5*1800/3)/SIN(1800/3);			
			SVPWM.T0 = Tz-SVPWM.T1-SVPWM.T2;		
			
			SVPWM.PWM1 = SVPWM.T1+SVPWM.T2+SVPWM.T0/2;
			SVPWM.PWM2 = SVPWM.T0/2;
			SVPWM.PWM3 = SVPWM.T1+SVPWM.T0/2;			
			break;
		default:
			break;
	}
	//
	if(SVPWM.PWM1>Tz)
		SVPWM.PWM1=Tz;
	if(SVPWM.PWM1<-Tz)
		SVPWM.PWM1 = -Tz;
	if(SVPWM.PWM2>Tz)
		SVPWM.PWM2=Tz;
	if(SVPWM.PWM2<-Tz)
		SVPWM.PWM2 = -Tz;
	if(SVPWM.PWM3>Tz)
		SVPWM.PWM3=Tz;
	if(SVPWM.PWM3<-Tz)
		SVPWM.PWM3 = -Tz;
	//ÉèÖÃÈýÂ·PWM
	TIM_SetCompare1(TIM1,SVPWM.PWM1);//
	TIM_SetCompare2(TIM1,SVPWM.PWM2);//
	TIM_SetCompare3(TIM1,SVPWM.PWM3);//
}
void cloopTuning( void )
{
	if( Cn < 1000 )
	{
		//Cd[Cn] = Current.Id;
		Cq[Cn] = Current.Iq;	
		Cn++;
	}
	else
	{
		tuningStartFlag=0;
	}
	if( (Cn<100)||(Cn>800)||(Cn>400&&Cn<600) )
		Current.targetCurrent = 0;
	else if( (Cn >100)&&(Cn < 400) )
		Current.targetCurrent = -Cti;
	else
		Current.targetCurrent = Cti;

}
void currentLoop( void )
{
	int temp;
	int tempA;
	int tempB;
	Current.Iq_exp = Current.targetCurrent;
	
	//Read Encoder Angle
	//Current.Theta = 3600*(ELEC_REVOLUTION_INC-TIM3->CNT%ELEC_REVOLUTION_INC)/(ELEC_REVOLUTION_INC);
	temp = getEncoderValue();
	Current.Theta = 3600*(temp%ELEC_REVOLUTION_INC)/(ELEC_REVOLUTION_INC);
	
	//Read current value from ADC1
	tempA = ADC1->JDR1;
	tempB = ADC1->JDR2;
	Current.IA = -(tempA - Current.IA_Offset)*CURRENT_K;//mA
	Current.IB = -(tempB - Current.IB_Offset)*CURRENT_K;//mA
	
	//Clarke Transform: Calc the I Alpha and I Beta
	Current.IAlpha = Current.IA;
	Current.IBeta = 0.57735*Current.IA + 1.1547*Current.IB;
	
	//Park Transform: Calc the Iq and Id
	Current.Id = Current.IAlpha*COS(Current.Theta)+Current.IBeta*SIN(Current.Theta);
	Current.Iq = -Current.IAlpha*SIN(Current.Theta)+Current.IBeta*COS(Current.Theta);
	
	//Calc the error
	Current.dPI.error = Current.Id_exp - Current.Id;
	Current.qPI.error = Current.Iq_exp - Current.Iq;
	//Calc
	Current.dPI.sum_error += Current.dPI.ki*Current.dPI.error;
	Current.qPI.sum_error += Current.qPI.ki*Current.qPI.error;
	//d PI error sum limitation
	if( Current.dPI.sum_error > Current.dPI.sum_error_max )
	{
		Current.dPI.sum_error = Current.dPI.sum_error_max;
	}
	else if( Current.dPI.sum_error < -Current.dPI.sum_error_max )
	{
		Current.dPI.sum_error = -Current.dPI.sum_error_max;
	}
	//q PI error sum limitation
	if( Current.qPI.sum_error > Current.qPI.sum_error_max )
	{
		Current.qPI.sum_error = Current.qPI.sum_error_max;
	}
	else if( Current.qPI.sum_error < -Current.qPI.sum_error_max )
	{
		Current.qPI.sum_error = -Current.qPI.sum_error_max;
	}
	
	//PI Control for Id and Iq
	Current.dPI.output = (Current.dPI.kp*Current.dPI.error + Current.dPI.sum_error)/Current.dPI.scale;
	Current.qPI.output = (Current.qPI.kp*Current.qPI.error + Current.qPI.sum_error)/Current.qPI.scale;
	//output limitation
	if( Current.dPI.output > Current.dPI.output_max )
	{
		Current.dPI.output = Current.dPI.output_max;
	}
	else if( Current.dPI.output < Current.dPI.output_min )
	{
		Current.dPI.output = Current.dPI.output_min;
	}
	if( Current.qPI.output > Current.qPI.output_max )
	{
		Current.qPI.output = Current.qPI.output_max;
	}
	else if( Current.qPI.output < Current.qPI.output_min )
	{
		Current.qPI.output = Current.qPI.output_min;
	}
	
	Current.Vd = Current.dPI.output;
	Current.Vq = Current.qPI.output;

//	Current.Vd = 0;
//	Current.Vq = A;
	
	//Inverse Park Transform
	Current.V_Alpha = Current.Vd*COS(Current.Theta)+Current.Vq*COS(Current.Theta+900);
	Current.V_Beta = Current.Vd*SIN(Current.Theta)+Current.Vq*SIN(Current.Theta+900);
	
	//SVPWM
	Current.V_total = sqrt(Current.V_Alpha*Current.V_Alpha+Current.V_Beta*Current.V_Beta);
	Current.V_theta = ATAN(Current.V_Alpha,Current.V_Beta);
	
	runSVPWM(Current.V_total,Current.V_theta);
	if( tuningStartFlag == 1 )
		cloopTuning();
}


void testSVPWMTask( void *pvParameters )
{
    int angle= 0;
    float theta = 0;
    A = 100;
    vTaskDelay(1000);
    PWMON();
    for(;;)
    {
        angle = angle + 10;
        theta = angle*PI/1800;
        runSVPWM(A,theta);
        vTaskDelay(1);
    }
}

void test_cloopTask( void *pvParameters )
{
	vTaskDelay(1000);
	//PWMON();
	currentLoopInit();
	for(;;)
	{
        currentLoop();
        vTaskDelay(1);
	}
}


